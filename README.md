# ğŸ—ï¸ Terraform Provider for CircleCI

<p align="center">
  <img src="https://img.shields.io/badge/terraform-%235835CC.svg?style=for-the-badge&logo=terraform&logoColor=white" alt="Terraform">
  <img src="https://img.shields.io/badge/circleci-343434?style=for-the-badge&logo=circleci&logoColor=white" alt="CircleCI">
  <img src="https://img.shields.io/badge/go-%2300ADD8.svg?style=for-the-badge&logo=go&logoColor=white" alt="Go">
</p>

<p align="center">
  <img src="https://img.shields.io/github/v/release/cedricfarinazzo/terraform-provider-circleci?style=flat-square" alt="Release">
  <img src="https://img.shields.io/github/license/cedricfarinazzo/terraform-provider-circleci?style=flat-square" alt="License">
  <img src="https://img.shields.io/github/go-mod/go-version/cedricfarinazzo/terraform-provider-circleci?style=flat-square" alt="Go Version">
</p>

A comprehensive Terraform provider for managing CircleCI resources using the CircleCI API v2.

> [!IMPORTANT]
> **âš ï¸ AI-Generated Provider - Use with Caution**  
> This provider was **generated by AI** from the [CircleCI API v2 documentation](https://circleci.com/docs/api/v2/index.html). While functional, it may contain bugs, edge cases, or unexpected behaviors that haven't been thoroughly tested in all scenarios.
> 
> **Important considerations:**
> - ğŸ¤– **AI-Generated Code**: May have logical errors or missing validations
> - ğŸ“š **API Documentation Dependency**: If the API documentation changes, this provider may become broken or incompatible
> - ğŸ§ª **Testing Recommended**: Always test thoroughly in non-production environments first
> - ğŸ› **Bug Reports Welcome**: Please report any issues you encounter to help improve the provider
> 
> Please monitor the API documentation for changes and validate all functionality before using in production environments.

## ğŸ“‹ Table of Contents

- [âœ¨ Features](#-features)
- [ğŸ“‹ Requirements](#-requirements)
- [ğŸš€ Installation](#-installation)
- [ğŸ” Authentication](#-authentication)
- [âš¡ Quick Start](#-quick-start)
- [ğŸ’¡ Usage Examples](#-usage-examples)
- [ğŸ› ï¸ Development](#ï¸-development)
- [ğŸ“– Documentation](#-documentation)
- [ğŸ¤ Contributing](#-contributing)
- [ğŸ“„ License](#-license)
- [ğŸ†˜ Support](#-support)
- [ğŸ™ Acknowledgments](#-acknowledgments)

## âœ¨ Features

This provider supports managing the following CircleCI resources:

### ğŸ”§ Resources
- **ğŸ”‘ Contexts** - Create and manage contexts for sharing environment variables
- **ğŸŒ Environment Variables** - Manage environment variables within contexts
- **ğŸ“ Projects** - Follow/unfollow projects and manage project settings
- **ğŸ” Checkout Keys** - Manage SSH keys for repository access
- **ğŸª Webhooks** - Configure webhooks for build notifications
- **â° Schedules** - Create and manage scheduled pipeline runs
- **ğŸ« OIDC Tokens** - Manage OpenID Connect authentication tokens
- **ğŸ“‹ Policies** - Manage organization policies for compliance and governance
- **ğŸ“Š Usage Exports** - Export organization usage data for analysis
- **ğŸƒ Runners** - Manage self-hosted runners for custom execution environments
- **ğŸŸï¸ Runner Tokens** - Manage authentication tokens for self-hosted runners

### ğŸ“š Data Sources
- **ğŸ”‘ Context** - Get information about existing contexts
- **ğŸ“ Project** - Get information about existing projects
- **ğŸ“ˆ Insights** - Retrieve workflow metrics and performance data
- **ğŸ¢ Organization** - Get information about organizations
- **ğŸ“‹ Policies** - List all policies in an organization

## ğŸ“‹ Requirements

- [Terraform](https://www.terraform.io/downloads.html) >= 1.0
- [Go](https://golang.org/doc/install) >= 1.21 (for development)

## ğŸš€ Installation

### ğŸ“¦ Terraform Registry (Recommended)

```terraform
terraform {
  required_providers {
    circleci = {
      source  = "cedricfarinazzo/circleci"
      version = "~> 1.0"
    }
  }
}
```

### ğŸ”¨ Manual Installation

1. Download the latest release from the [releases page](https://github.com/cedricfarinazzo/terraform-provider-circleci/releases)
2. Extract the binary to your Terraform plugins directory
3. Run `terraform init`

## ğŸ” Authentication

The provider requires a CircleCI API token for authentication. You can obtain a token from your [CircleCI Personal API Tokens](https://app.circleci.com/settings/user/tokens) page.

### ğŸŒ Environment Variable (Recommended)

```bash
export CIRCLECI_TOKEN="your-api-token-here"
```

### âš™ï¸ Provider Configuration

```terraform
provider "circleci" {
  api_token = "your-api-token-here"
  # base_url = "https://circleci.com/api/v2" # Optional, defaults to CircleCI cloud
}
```

## âš¡ Quick Start

Here's a minimal example to get you started:

```terraform
terraform {
  required_providers {
    circleci = {
      source  = "cedricfarinazzo/circleci"
      version = "~> 1.0"
    }
  }
}

provider "circleci" {
  # Token can be set via CIRCLECI_TOKEN environment variable
}

# Create a context for shared environment variables
resource "circleci_context" "shared" {
  name = "shared-context"
  owner = {
    id   = "your-org-id"
    slug = "github"
    type = "organization"
  }
}

# Add an environment variable to the context
resource "circleci_environment_variable" "api_key" {
  context_id = circleci_context.shared.id
  name       = "API_KEY"
  value      = "your-secret-api-key"
}

# Follow a project
resource "circleci_project" "example" {
  slug = "gh/your-org/your-repo"
}
```

## ğŸ’¡ Usage Examples

### ğŸ”‘ Basic Context Management

```terraform
resource "circleci_context" "shared" {
  name = "shared-context"
  owner = {
    id   = "your-org-id"
    slug = "github"
    type = "organization"
  }
}

resource "circleci_environment_variable" "api_key" {
  context_id = circleci_context.shared.id
  name       = "API_KEY"
  value      = "your-secret-api-key"
}
```

### ğŸ“ Project Management

```terraform
resource "circleci_project" "example" {
  slug = "gh/your-org/your-repo"
}

resource "circleci_checkout_key" "deploy_key" {
  project_slug = circleci_project.example.slug
  type         = "deploy-key"
}
```

### ğŸª Webhook Configuration

```terraform
resource "circleci_webhook" "notifications" {
  name   = "Build Notifications"
  url    = "https://your-app.com/webhooks/circleci"
  events = ["workflow-completed"]
  
  scope = {
    id   = circleci_project.example.id
    type = "project"
  }
  
  verify_tls     = true
  signing_secret = "your-webhook-secret"
}
```

### â° Scheduled Builds

```terraform
resource "circleci_schedule" "nightly" {
  project_slug = "gh/your-org/your-repo"
  name         = "Nightly Build"
  description  = "Run tests every night"
  
  timetable = {
    hours_of_day = [2]
    days_of_week = ["MON", "TUE", "WED", "THU", "FRI"]
  }
  
  attribution_actor = {
    id = "your-user-id"
  }
}
```

### ğŸ“š Data Sources

```terraform
data "circleci_insight" "metrics" {
  project_slug = "gh/your-org/your-repo"
  workflow     = "build-and-test"
  branch       = "main"
}

output "success_rate" {
  value = data.circleci_insight.metrics.metrics.success_rate
}

data "circleci_policies" "org_policies" {
  org_id = "bb604b45-b6b0-4b81-ad80-796f15eddf87"
}
```

### ğŸš€ Advanced Features

```terraform
# Policy Management
resource "circleci_policy" "security_policy" {
  name        = "Security Requirements"
  description = "Enforce security scanning in all workflows"
  org_id      = "bb604b45-b6b0-4b81-ad80-796f15eddf87"
  enabled     = true
  content     = file("${path.module}/policies/security.rego")
}

# Usage Exports
resource "circleci_usage_export" "monthly_report" {
  org_id = "bb604b45-b6b0-4b81-ad80-796f15eddf87"
  start  = "2024-01-01T00:00:00Z"
  end    = "2024-01-31T23:59:59Z"
}

# Self-hosted Runner Management
resource "circleci_runner" "build_runner" {
  resource_class = "my-org/my-runner-class"
  name           = "build-runner-01"
  description    = "Runner for build jobs"
}

resource "circleci_runner_token" "runner_auth" {
  resource_class = "my-org/my-runner-class"
  nickname       = "build-runner-token"
}
```

## ğŸ› ï¸ Development

### ğŸ”¨ Building the Provider

```bash
git clone https://github.com/cedricfarinazzo/terraform-provider-circleci
cd terraform-provider-circleci
go build
```

### ğŸ§ª Running Tests

```bash
go test ./...
```

### ğŸ¯ Running Acceptance Tests

```bash
export CIRCLECI_TOKEN="your-test-token"
export TF_ACC=1
go test ./... -v
```

### ğŸ’» Local Development

1. Build the provider:
   ```bash
   go build -o terraform-provider-circleci
   ```

2. Create a `.terraformrc` file in your home directory:
   ```terraform
   provider_installation {
     dev_overrides {
       "cedricfarinazzo/circleci" = "/path/to/terraform-provider-circleci"
     }
     direct {}
   }
   ```

3. Use the provider in your Terraform configuration:
   ```terraform
   terraform {
     required_providers {
       circleci = {
         source = "cedricfarinazzo/circleci"
       }
     }
   }
   ```

## ğŸ“– Documentation

Full documentation for all resources and data sources is available in the [docs](./docs) directory or on the [Terraform Registry](https://registry.terraform.io/providers/cedricfarinazzo/circleci/latest/docs).

## ğŸ¤ Contributing

We welcome contributions! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for details.

### ğŸ› Reporting Issues

If you encounter any issues, please report them on the [GitHub issues page](https://github.com/cedricfarinazzo/terraform-provider-circleci/issues).

## ğŸ“„ License

This project is licensed under the Mozilla Public License 2.0 - see the [LICENSE](LICENSE) file for details.

## ğŸ†˜ Support

- **ğŸ“– Documentation**: [Terraform Registry](https://registry.terraform.io/providers/cedricfarinazzo/circleci/latest/docs)
- **ğŸ› Issues**: [GitHub Issues](https://github.com/cedricfarinazzo/terraform-provider-circleci/issues)
- **ğŸ”— CircleCI API Documentation**: [CircleCI API v2](https://circleci.com/docs/api/v2/index.html)

## ğŸ™ Acknowledgments

- [CircleCI](https://circleci.com/) for providing the API
- [Terraform](https://terraform.io/) for the provider framework
- [HashiCorp](https://hashicorp.com/) for the Terraform Plugin Framework