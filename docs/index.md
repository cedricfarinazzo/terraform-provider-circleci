# CircleCI Provider

The CircleCI provider allows you to manage CircleCI resources using Terraform. This provider enables you to configure projects, contexts, environment variables, runners, policies, and more through Infrastructure as Code.

> [!IMPORTANT]
> **⚠️ AI-Generated Provider - Use with Caution**  
> This provider was **generated by AI** from the [CircleCI API v2 documentation](https://circleci.com/docs/api/v2/index.html). While functional, it may contain bugs, edge cases, or unexpected behaviors that haven't been thoroughly tested in all scenarios.
> 
> **Important considerations:**
> - 🤖 **AI-Generated Code**: May have logical errors or missing validations
> - 📚 **API Documentation Dependency**: If the API documentation changes, this provider may become broken or incompatible
> - 🧪 **Testing Recommended**: Always test thoroughly in non-production environments first
> - 🐛 **Bug Reports Welcome**: Please report any issues you encounter to help improve the provider
> 
> Please monitor the API documentation for changes and validate all functionality before using in production environments.

## Example Usage

```terraform
terraform {
  required_providers {
    circleci = {
      source  = "cedric-farinazzo/circleci"
      version = "~> 0.1.2"
    }
  }
}

provider "circleci" {
  token = var.circleci_token
}
```

## Authentication

The CircleCI provider requires a CircleCI API token for authentication. You can obtain a token from your [CircleCI Personal API Tokens](https://app.circleci.com/settings/user/tokens) page.

### Environment Variables

You can provide your credentials via the `CIRCLECI_TOKEN` environment variable:

```bash
export CIRCLECI_TOKEN="your-circleci-token"
```

### Provider Configuration

Alternatively, you can configure the token directly in the provider block:

```terraform
provider "circleci" {
  token = "your-circleci-token"
}
```

**Note:** Hard-coding credentials is not recommended for production use. Consider using environment variables or a secrets management system.

## Argument Reference

The following arguments are supported in the `provider` block:

- `token` - (Optional) The CircleCI API token. This can also be specified with the `CIRCLECI_TOKEN` environment variable.
- `base_url` - (Optional) The base URL for the CircleCI API. Defaults to `https://circleci.com/api/v2`. This can also be specified with the `CIRCLECI_BASE_URL` environment variable.

## Available Resources

This provider supports the following CircleCI resources:

### Project Management
- [`circleci_project`](./resources/project.md) - Manage CircleCI projects and their settings
- [`circleci_environment_variable`](./resources/environment_variable.md) - Manage project-level environment variables

### Contexts and Security
- [`circleci_context`](./resources/context.md) - Manage CircleCI contexts for sharing environment variables
- [`circleci_policy`](./resources/policy.md) - Manage organization policies and compliance rules

### Runners and Infrastructure
- [`circleci_runner`](./resources/runner.md) - Manage self-hosted runners
- [`circleci_runner_token`](./resources/runner_token.md) - Manage runner authentication tokens

### Data Export and Usage
- [`circleci_usage_export`](./resources/usage_export.md) - Configure usage data exports

## Available Data Sources

### Project Information
- [`circleci_project`](./data-sources/project.md) - Get information about a CircleCI project
- [`circleci_organization`](./data-sources/organization.md) - Get organization details and settings
- [`circleci_insights`](./data-sources/insights.md) - Access project insights and analytics

### Security and Contexts
- [`circleci_context`](./data-sources/context.md) - Get information about a CircleCI context
- [`circleci_policies`](./data-sources/policies.md) - Retrieve organization policies

## Getting Started

1. Install Terraform and configure the CircleCI provider
2. Obtain a CircleCI API token
3. Configure the provider with your token
4. Start managing your CircleCI resources with Terraform

### Basic Example

```terraform
# Configure the CircleCI provider
provider "circleci" {
  token = var.circleci_token
}

# Create a CircleCI context
resource "circleci_context" "example" {
  name         = "example-context"
  organization = "your-org"
}

# Manage project environment variables
resource "circleci_environment_variable" "example" {
  project = "gh/your-org/your-repo"
  name    = "ENV_VAR"
  value   = "example-value"
}

# Set up a self-hosted runner
resource "circleci_runner" "example" {
  name           = "my-runner"
  resource_class = "my-org/my-runner-class"
  description    = "Self-hosted runner for CI/CD"
}

# Create a runner token
resource "circleci_runner_token" "example" {
  resource_class = circleci_runner.example.resource_class
  nickname       = "runner-token"
}
```

### Advanced Configuration

For more complex setups involving contexts, policies, and runners, check out the examples:

- [Complete Setup](../examples/complete-setup.tf) - Full provider configuration
- [Context Management](../examples/contexts.tf) - Managing contexts and environment variables
- [Runner Configuration](../examples/runners.tf) - Self-hosted runner setup
- [Policy Management](../examples/policies.tf) - Organization policy configuration
- [Data Sources](../examples/data-sources.tf) - Using data sources for insights

## Import Support

Most resources support importing existing CircleCI resources into your Terraform state. See the individual resource documentation for specific import syntax.

Example import commands:
```bash
# Import a project
terraform import circleci_project.example "gh/your-org/your-repo"

# Import a context
terraform import circleci_context.example "context-id"

# Import a runner
terraform import circleci_runner.example "runner-id"
```

## Rate Limiting

The CircleCI API has rate limits. The provider automatically handles rate limiting with exponential backoff retry logic to ensure reliable operations.

## Best Practices

1. **Use environment variables** for sensitive data like tokens
2. **Organize resources** using contexts for shared environment variables
3. **Implement policies** to enforce security and compliance requirements
4. **Monitor usage** with insights and usage export features
5. **Test configurations** in development environments before applying to production

## Troubleshooting

- Ensure your CircleCI token has the necessary permissions for the resources you're managing
- Check the CircleCI API documentation for any rate limits or restrictions
- Use Terraform's debugging features (`TF_LOG=DEBUG`) for detailed error information

## Support

For issues and feature requests, please visit the [GitHub repository](https://github.com/cedric-farinazzo/terraform-provider-circleci).

## Version Compatibility

This provider is compatible with:
- Terraform >= 1.0
- CircleCI API v2
- Go >= 1.21
